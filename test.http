@base = http://localhost:3000
@json = application/json
# Biến này sẽ được cập nhật tự động sau khi Link Bank thành công.
@lastBankId = 0


### ─────────────────────────────
### Health & Wallet
### ─────────────────────────────

### HEAD /auth/password/change (health)
HEAD {{base}}/api/auth/password/change

### GET /wallet
GET {{base}}/api/wallet

### GET /withdrawals
GET {{base}}/api/withdrawals

### GET /commissions
GET {{base}}/api/commissions


### ─────────────────────────────
### Withdraw
### ─────────────────────────────

###
# Rút tiền: amount = 5000, sử dụng bank mặc định
POST {{base}}/api/withdraw
Content-Type: {{json}}

{
  "amount": 5000,
  "methodId": "0"   // "0" = để API tự chọn bank mặc định của user
}

### (Tuỳ chọn) Rút vượt số dư để thấy lỗi validate
POST {{base}}/api/withdraw
Content-Type: {{json}}

{
  "amount": 99999999,
  "methodId": "0"
}


### ─────────────────────────────
### Banks
### ─────────────────────────────

### GET /banks (Xem danh sách các bank hiện có)
GET {{base}}/api/banks


### (Tuỳ chọn) Xoá bank đang test (Cần biết ID)
POST {{base}}/api/banks/delete
Content-Type: {{json}}

{
  "id": "10" 
}


### POST /banks/link → tạo bank mới & lưu biến {{lastBankId}}
# SỬA LỖI 409: Dùng số tài khoản mới (1903000001) để tránh trùng lặp
POST {{base}}/api/banks/link
Content-Type: {{json}}

{
  "bankName": "MB Bank",
  "number": "1903000001",
  "holder": "Nguyen Van Test"
}

> {% client.global.set("lastBankId", response.body.id); %}
# Sau lệnh này, biến {{lastBankId}} sẽ có id ngân hàng mới.

### POST /banks/select (chọn bank vừa link)
POST {{base}}/api/banks/select
Content-Type: {{json}}

{
  "id": "{{lastBankId}}"
}

### (Tuỳ chọn) Xoá bank vừa link bằng biến
POST {{base}}/api/banks/delete
Content-Type: {{json}}

{
  "id": "{{lastBankId}}"
}


### ─────────────────────────────
### Support (form nhẹ) & Chat
### ─────────────────────────────

### POST /support/send (form gửi nhanh – chọn room hợp lý)
POST {{base}}/api/support/send
Content-Type: {{json}}

{
  "room": "withdraw-slow",
  "text": "Giao dịch rút tiền chậm, vui lòng kiểm tra giúp mình."
}

### POST /support/chat/send (chat thread)
POST {{base}}/api/support/chat/send
Content-Type: {{json}}

{
  "room": "default",
  "text": "Xin chào, mình cần hỗ trợ vấn đề rút tiền."
}

### GET /support/chat/history
GET {{base}}/api/support/chat/history?room=default


### ─────────────────────────────
### Auth – Đổi mật khẩu hiện tại (DEMO_USER_ID=1)
### ─────────────────────────────
# LƯU Ý: chỉ để test – khi có session thật sẽ thay bằng id từ phiên.
POST {{base}}/api/auth/password/change
Content-Type: {{json}}

{
  "current": "123456",
  "next": "abcxyz1"
}


### ─────────────────────────────
### Auth – Quên mật khẩu qua OTP (REAL MAIL)
### ─────────────────────────────
# Điền một email có thật trong DB (đã seed).
@email = pgiap316@gmail.com

### 1) Gửi OTP
POST {{base}}/api/auth/password/forgot/send-otp
Content-Type: {{json}}

{
  "email": "{{email}}"
}

### 2) (Tuỳ chọn) Verify OTP (điền mã OTP từ email)
# @otp = 123456  ← ĐIỀN OTP THẬT 6 CHỮ SỐ
@otp = 123456

POST {{base}}/api/auth/password/forgot/verify
Content-Type: {{json}}

{
  "email": "{{email}}",
  "otp": "{{otp}}"
}

### 3) Reset password bằng OTP
POST {{base}}/api/auth/password/reset
Content-Type: {{json}}

{
  "email": "{{email}}",
  "otp": "{{otp}}",
  "newPassword": "abcdef"
}